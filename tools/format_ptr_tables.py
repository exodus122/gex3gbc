import re

raw = """data_02_????:
 db $b5, $56, $b8, $56, $b8, $56, $eb, $56 ;; 02:55c5 ........
 db $12, $57, $15, $57, $00, $00, $00, $00 ;; 02:55cd ........
 db $00, $00, $00, $00, $00, $00, $00, $00 ;; 02:55d5 ??......
 db $00, $00, $00, $00, $44, $57, $44, $57 ;; 02:55dd ........
 db $00, $00, $00, $00, $00, $00, $00, $00 ;; 02:55e5 ......??
 db $00, $00, $00, $00, $00, $00, $00, $00 ;; 02:55ed ????????
 db $00, $00, $57, $57, $00, $00, $00, $00 ;; 02:55f5 ??????..
 db $00, $00, $00, $00, $00, $00, $00, $00 ;; 02:55fd ????????
 db $6a, $57, $00, $00, $00, $00, $8f, $57 ;; 02:5605 ????????
 db $92, $57, $b7, $57, $b7, $57, $00, $00 ;; 02:560d ????????
 db $00, $00, $00, $00, $00, $00, $00, $00 ;; 02:5615 ????????
 db $00, $00, $00, $00, $00, $00, $79, $57 ;; 02:561d ????????
 db $00, $00, $7c, $57, $00, $00, $7c, $57 ;; 02:5625 ????????
 db $00, $00, $00, $00, $00, $00, $00, $00 ;; 02:562d ????????
 db $00, $00, $00, $00, $00, $00, $00, $00 ;; 02:5635 ????????
 db $ca, $57, $cd, $57, $cd, $57, $f2, $57 ;; 02:563d ????????
 db $00, $00, $00, $00, $00, $00, $00, $00 ;; 02:5645 ????????
 db $00, $00, $00, $00, $00, $00, $00, $00 ;; 02:564d ????????
 db $00, $00, $00, $00, $1b, $58, $1b, $58 ;; 02:5655 ????????
 db $00, $00, $00, $00, $00, $00, $00, $00 ;; 02:565d ????????
 db $00, $00, $00, $00, $00, $00, $00, $00 ;; 02:5665 ????????
 db $00, $00, $57, $57, $00, $00, $00, $00 ;; 02:566d ????????
 db $00, $00, $00, $00, $00, $00, $00, $00 ;; 02:5675 ????????
 db $6a, $57, $00, $00, $00, $00, $8f, $57 ;; 02:567d ????????
 db $92, $57, $b7, $57, $b7, $57, $00, $00 ;; 02:5685 ????????
 db $00, $00, $00, $00, $00, $00, $00, $00 ;; 02:568d ????????
 db $00, $00, $00, $00, $00, $00, $79, $57 ;; 02:5695 ????????
 db $00, $00, $7c, $57, $00, $00, $7c, $57 ;; 02:569d ????????
 db $00, $00, $00, $00, $00, $00, $00, $00 ;; 02:56a5 ????????
 db $00, $00, $00, $00, $00, $00, $00, $00 ;; 02:56ad ????????
 db $fe, $01, $ff, $50, $03, $10, $03, $90 ;; 02:56b5 .w..w.w.
 db $04, $80, $04, $a0, $04, $20, $03, $60 ;; 02:56bd ?.w.?.w.
 db $03, $01, $10, $41, $10, $51, $10, $11 ;; 02:56c5 ?.w.?.?.
 db $10, $91, $10, $81, $10, $a1, $10, $21 ;; 02:56cd w.?.?.?.
 db $10, $61, $10, $02, $0e, $42, $0e, $52 ;; 02:56d5 w.?.w.?.
 db $0e, $12, $0e, $92, $0e, $82, $0e, $a2 ;; 02:56dd ?.w.?.?.
 db $0e, $22, $0e, $62, $0e, $ff, $01, $10 ;; 02:56e5 ?.w.?..w
 db $41, $10, $51, $10, $11, $10, $91, $10 ;; 02:56ed .?.?.w.w
 db $81, $10, $a1, $10, $21, $10, $61, $10 ;; 02:56f5 .?.?.w.?
 db $12, $0e, $22, $0e, $52, $0e, $62, $0e ;; 02:56fd .w.w.?.?
 db $80, $07, $90, $07, $a0, $07, $40, $01 ;; 02:5705 .?.w.w.w
 db $03, $01, $00, $01, $ff, $00, $01, $ff ;; 02:570d .?.w..w.
 db $82, $0e, $92, $0e, $a2, $0e, $12, $0e ;; 02:5715 .?.?.?.?
 db $22, $0e, $42, $0e, $52, $0e, $62, $0e ;; 02:571d .?.?.?.?
 db $01, $10, $41, $10, $51, $10, $11, $10 ;; 02:5725 .?.?.?.?
 db $91, $10, $81, $10, $a1, $10, $21, $10 ;; 02:572d .?.?.w.?
 db $61, $10, $40, $06, $50, $06, $60, $06 ;; 02:5735 .?.?.?.?
 db $10, $03, $20, $03, $00, $06, $ff, $01 ;; 02:573d .w.?.w..
 db $10, $41, $10, $51, $10, $11, $10, $91 ;; 02:5745 w.?.?.w.
 db $10, $81, $10, $a1, $10, $21, $10, $61 ;; 02:574d ?.?.?.w.
 
 db $10, $ff, $01, $1f, $41, $1f, $51, $1f ;; 02:5755 ?.??????
 db $11, $1f, $91, $1f, $81, $1f, $a1, $1f ;; 02:575d ????????
 db $21, $1f, $61, $1f, $ff, $02, $0f, $42 ;; 02:5765 ????????
 db $0f, $52, $0f, $12, $0f, $22, $0f, $62 ;; 02:576d ????????
 db $0f, $80, $21, $ff, $fe, $30, $ff, $01 ;; 02:5775 ????????
 db $34, $41, $34, $51, $34, $11, $34, $91 ;; 02:577d ????????
 db $34, $81, $34, $a1, $34, $21, $34, $61 ;; 02:5785 ????????
 db $34, $ff, $fe, $24, $ff, $01, $27, $41 ;; 02:578d ????????
 db $27, $51, $27, $11, $27, $91, $27, $81 ;; 02:5795 ????????
 db $27, $a1, $27, $21, $27, $61, $27, $02 ;; 02:579d ????????
 db $25, $42, $25, $52, $25, $12, $25, $92 ;; 02:57a5 ????????
 db $25, $82, $25, $a2, $25, $22, $25, $62 ;; 02:57ad ????????
 db $25, $ff, $01, $27, $41, $27, $51, $27 ;; 02:57b5 ????????
 db $11, $27, $91, $27, $81, $27, $a1, $27 ;; 02:57bd ????????
 db $21, $27, $61, $27, $ff, $fe, $3d, $ff ;; 02:57c5 ????????
 db $40, $3f, $50, $3f, $10, $3f, $90, $3f ;; 02:57cd ????????
 db $80, $3f, $a0, $3f, $20, $3f, $60, $3f ;; 02:57d5 ????????
 db $01, $4c, $02, $4a, $42, $4a, $52, $4a ;; 02:57dd ????????
 db $12, $4a, $92, $4a, $82, $4a, $a2, $4a ;; 02:57e5 ????????
 db $22, $4a, $62, $4a, $ff, $01, $4c, $41 ;; 02:57ed ????????
 db $4c, $51, $4c, $11, $4c, $91, $4c, $81 ;; 02:57f5 ????????
 db $4c, $a1, $4c, $21, $4c, $61, $4c, $02 ;; 02:57fd ????????
 db $4a, $42, $4a, $52, $4a, $12, $4a, $92 ;; 02:5805 ????????
 db $4a, $82, $4a, $a2, $4a, $22, $4a, $62 ;; 02:580d ????????
 db $4a, $03, $3d, $00, $3d, $ff, $01, $4c ;; 02:5815 ????????
 db $41, $4c, $51, $4c, $11, $4c, $91, $4c ;; 02:581d ????????
 db $81, $4c, $a1, $4c, $21, $4c, $61, $4c ;; 02:5825 ????????
 db $ff                                     ;; 02:582d ?
"""

line_pattern = re.compile(r'db\s+((?:\$[0-9a-fA-F]{2},?\s*)+)\s*;;\s*02:([0-9a-fA-F]{4})')
lines = []
for m in line_pattern.finditer(raw):
    addr = int(m.group(2), 16)
    bs = [int(x.strip().lstrip('$'), 16) for x in m.group(1).split(',') if x.strip()]
    lines.append((addr, bs))

mem = {}
for addr, bs in lines:
    for i, b in enumerate(bs):
        mem[addr + i] = b

PTR_START  = 0x55c5
PTR_END    = 0x56b3
DATA_START = 0x56b5

ptr_table = []
addr = PTR_START
while addr <= PTR_END:
    lo = mem.get(addr, 0)
    hi = mem.get(addr+1, 0)
    ptr_table.append((hi << 8) | lo)
    addr += 2

destinations = sorted(set(w for w in ptr_table if w != 0))
label_map = {a: f".data_02_{a:04x}" for a in destinations}

# --- Flatten all data bytes into a single list (addr, byte) ---
flat = []
for (a, bs) in lines:
    if a >= DATA_START:
        for i, b in enumerate(bs):
            flat.append((a + i, b))

# Build label set (mutable)
label_addrs = set(destinations)

# --- Emit ---
out = []
out.append("data_02_????:")
for w in ptr_table:
    out.append(f"    dw   {label_map[w] if w else '$0000'}")
out.append("")

# Walk flat bytes; split db lines at label boundaries
# We'll collect a current run of bytes between labels
run_bytes = []
run_start = None

def flush_run(run_start, run_bytes, out):
    if not run_bytes:
        return
    # emit in rows of 8
    i = 0
    while i < len(run_bytes):
        chunk = run_bytes[i:i+8]
        hex_str = ", ".join(f"${b:02x}" for b in chunk)
        out.append(f"    db   {hex_str}")
        i += 8

for (a, b) in flat:
    if a in label_addrs:
        # flush current run
        flush_run(run_start, run_bytes, out)
        run_bytes = []
        run_start = a
        out.append(f"{label_map[a]}:")
        label_addrs.discard(a)
    if run_start is None:
        run_start = a
    run_bytes.append(b)

flush_run(run_start, run_bytes, out)

print("\n".join(out))

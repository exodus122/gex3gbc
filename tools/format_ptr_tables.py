import re

raw = """data_03_59ea_SpriteData:
    db   $7a, $5a, $83, $5a, $7a, $5a, $83, $5a        ;; 03:59ea ????????
    db   $8c, $5a, $9d, $5a, $8c, $5a, $9d, $5a        ;; 03:59f2 ????????
    db   $ae, $5a, $c7, $5a, $ae, $5a, $c7, $5a        ;; 03:59fa ..??????
    db   $e0, $5a, $01, $5b, $e0, $5a, $01, $5b        ;; 03:5a02 ....????
    db   $22, $5b, $27, $5b, $22, $5b, $27, $5b        ;; 03:5a0a ..??????
    db   $2c, $5b, $35, $5b, $2c, $5b, $35, $5b        ;; 03:5a12 ....????
    db   $3e, $5b, $4b, $5b, $3e, $5b, $4b, $5b        ;; 03:5a1a ????????
    db   $58, $5b, $69, $5b, $58, $5b, $69, $5b        ;; 03:5a22 ????????
    db   $7a, $5b, $7a, $5b, $7a, $5b, $7a, $5b        ;; 03:5a2a ..??????
    db   $db, $5b, $db, $5b, $fc, $5b, $fc, $5b        ;; 03:5a32 ????????
    db   $1d, $5c, $5e, $5c, $1d, $5c, $5e, $5c        ;; 03:5a3a ????????
    db   $9f, $5c, $e0, $5c, $9f, $5c, $e0, $5c        ;; 03:5a42 ????????
    db   $21, $5d, $3a, $5d, $21, $5d, $3a, $5d        ;; 03:5a4a ????????
    db   $53, $5d, $53, $5d, $53, $5d, $53, $5d        ;; 03:5a52 ????????
    db   $94, $5d, $c5, $5d, $94, $5d, $c5, $5d        ;; 03:5a5a ????????
    db   $f6, $5d, $f6, $5d, $f6, $5d, $f6, $5d        ;; 03:5a62 ????????
    db   $3f, $5e, $3f, $5e, $3f, $5e, $3f, $5e        ;; 03:5a6a ????????
    db   $50, $5e, $50, $5e, $50, $5e, $50, $5e        ;; 03:5a72 ????????
    db   $02, $f0, $fc, $00, $00, $00, $fc, $02        ;; 03:5a7a ????????
    db   $00, $02, $f0, $fc, $00, $20, $00, $fc        ;; 03:5a82 ????????
    db   $02, $20, $04, $f0, $f8, $00, $00, $f0        ;; 03:5a8a ????????
    db   $00, $04, $00, $00, $f8, $02, $00, $00        ;; 03:5a92 ????????
    db   $00, $06, $00, $04, $f0, $00, $00, $20        ;; 03:5a9a ????????
    db   $f0, $f8, $04, $20, $00, $00, $02, $20        ;; 03:5aa2 ????????
    db   $00, $f8, $06, $20, $06, $f0, $f4, $00        ;; 03:5aaa ????...?
    db   $00, $f0, $fc, $04, $00, $f0, $04, $08        ;; 03:5ab2 ?..??..?
    db   $00, $00, $f4, $02, $00, $00, $fc, $06        ;; 03:5aba ?..??..?
    db   $00, $00, $04, $0a, $00, $06, $f0, $04        ;; 03:5ac2 ?..?????
    db   $00, $20, $f0, $fc, $04, $20, $f0, $f4        ;; 03:5aca ????????
    db   $08, $20, $00, $04, $02, $20, $00, $fc        ;; 03:5ad2 ????????
    db   $06, $20, $00, $f4, $0a, $20, $08, $f0        ;; 03:5ada ??????..
    db   $f0, $00, $00, $f0, $f8, $04, $00, $f0        ;; 03:5ae2 .??..??.
    db   $00, $08, $00, $f0, $08, $0c, $00, $00        ;; 03:5aea .??..??.
    db   $f0, $02, $00, $00, $f8, $06, $00, $00        ;; 03:5af2 .??..??.
    db   $00, $0a, $00, $00, $08, $0e, $00, $08        ;; 03:5afa .??..??.
    db   $f0, $08, $00, $20, $f0, $00, $04, $20        ;; 03:5b02 ..??..??
    db   $f0, $f8, $08, $20, $f0, $f0, $0c, $20        ;; 03:5b0a ..??..??
    db   $00, $08, $02, $20, $00, $00, $06, $20        ;; 03:5b12 ..??..??
    db   $00, $f8, $0a, $20, $00, $f0, $0e, $20        ;; 03:5b1a ..??..??
    db   $01, $f8, $fc, $00, $00, $01, $f8, $fc        ;; 03:5b22 ...?????
    db   $00, $20, $02, $f8, $f8, $00, $00, $f8        ;; 03:5b2a ??...??.
    db   $00, $02, $00, $02, $f8, $00, $00, $20        ;; 03:5b32 .??...??
    db   $f8, $f8, $02, $20, $03, $f8, $f4, $00        ;; 03:5b3a ..??????
    db   $00, $f8, $fc, $02, $00, $f8, $04, $04        ;; 03:5b42 ????????
    db   $00, $03, $f8, $04, $00, $20, $f8, $fc        ;; 03:5b4a ????????
    db   $02, $20, $f8, $f4, $04, $20, $04, $f8        ;; 03:5b52 ????????
    db   $f0, $00, $00, $f8, $f8, $02, $00, $f8        ;; 03:5b5a ????????
    db   $00, $04, $00, $f8, $08, $06, $00, $04        ;; 03:5b62 ????????
    db   $f8, $08, $00, $20, $f8, $00, $02, $20        ;; 03:5b6a ????????
    db   $f8, $f8, $04, $20, $f8, $f0, $06, $20        ;; 03:5b72 ????????
    db   $18, $e8, $e0, $00, $08, $e8, $e8, $06        ;; 03:5b7a ...??..?
    db   $08, $e8, $f0, $0c, $08, $e8, $f8, $12        ;; 03:5b82 ?..??..?
    db   $08, $e8, $00, $18, $08, $e8, $08, $1e        ;; 03:5b8a ?..??..?
    db   $08, $e8, $10, $24, $08, $e8, $18, $2a        ;; 03:5b92 ?..??..?
    db   $08, $f8, $e0, $02, $08, $f8, $e8, $08        ;; 03:5b9a ?..??..?
    db   $08, $f8, $f0, $0e, $08, $f8, $f8, $14        ;; 03:5ba2 ?..??..?
    db   $08, $f8, $00, $1a, $08, $f8, $08, $20        ;; 03:5baa ?..??..?
    db   $08, $f8, $10, $26, $08, $f8, $18, $2c        ;; 03:5bb2 ?..??..?
    db   $08, $08, $e0, $04, $08, $08, $e8, $0a        ;; 03:5bba ?..??..?
    db   $08, $08, $f0, $10, $08, $08, $f8, $16        ;; 03:5bc2 ?..??..?
    db   $08, $08, $00, $1c, $08, $08, $08, $22        ;; 03:5bca ?..??..?
    db   $08, $08, $10, $28, $08, $08, $18, $2e        ;; 03:5bd2 ?..??..?
    db   $08, $08, $c0, $fc, $00, $00, $d0, $fc        ;; 03:5bda ????????
    db   $00, $00, $e0, $fc, $00, $00, $f0, $fc        ;; 03:5be2 ????????
    db   $00, $00, $00, $fc, $00, $00, $10, $fc        ;; 03:5bea ????????
    db   $00, $00, $20, $fc, $00, $00, $30, $fc        ;; 03:5bf2 ????????
    db   $00, $00, $08, $c0, $fc, $00, $20, $d0        ;; 03:5bfa ????????
    db   $fc, $00, $20, $e0, $fc, $00, $20, $f0        ;; 03:5c02 ????????
    db   $fc, $00, $20, $00, $fc, $00, $20, $10        ;; 03:5c0a ????????
    db   $fc, $00, $20, $20, $fc, $00, $20, $30        ;; 03:5c12 ????????
    db   $fc, $00, $20, $10, $e0, $f0, $00, $00        ;; 03:5c1a ????????
    db   $e0, $f8, $08, $00, $e0, $00, $10, $00        ;; 03:5c22 ????????
    db   $e0, $08, $18, $00, $f0, $f0, $02, $00        ;; 03:5c2a ????????
    db   $f0, $f8, $0a, $00, $f0, $00, $12, $00        ;; 03:5c32 ????????
    db   $f0, $08, $1a, $00, $00, $f0, $04, $00        ;; 03:5c3a ????????
    db   $00, $f8, $0c, $00, $00, $00, $14, $00        ;; 03:5c42 ????????
    db   $00, $08, $1c, $00, $10, $f0, $06, $00        ;; 03:5c4a ????????
    db   $10, $f8, $0e, $00, $10, $00, $16, $00        ;; 03:5c52 ????????
    db   $10, $08, $1e, $00, $10, $e0, $08, $00        ;; 03:5c5a ????????
    db   $20, $e0, $00, $08, $20, $e0, $f8, $10        ;; 03:5c62 ????????
    db   $20, $e0, $f0, $18, $20, $f0, $08, $02        ;; 03:5c6a ????????
    db   $20, $f0, $00, $0a, $20, $f0, $f8, $12        ;; 03:5c72 ????????
    db   $20, $f0, $f0, $1a, $20, $00, $08, $04        ;; 03:5c7a ????????
    db   $20, $00, $00, $0c, $20, $00, $f8, $14        ;; 03:5c82 ????????
    db   $20, $00, $f0, $1c, $20, $10, $08, $06        ;; 03:5c8a ????????
    db   $20, $10, $00, $0e, $20, $10, $f8, $16        ;; 03:5c92 ????????
    db   $20, $10, $f0, $1e, $20, $10, $e0, $f0        ;; 03:5c9a ????????
    db   $00, $08, $e0, $f8, $08, $08, $e0, $00        ;; 03:5ca2 ????????
    db   $10, $08, $e0, $08, $18, $08, $f0, $f0        ;; 03:5caa ????????
    db   $02, $08, $f0, $f8, $0a, $08, $f0, $00        ;; 03:5cb2 ????????
    db   $12, $08, $f0, $08, $1a, $08, $00, $f0        ;; 03:5cba ????????
    db   $04, $08, $00, $f8, $0c, $08, $00, $00        ;; 03:5cc2 ????????
    db   $14, $08, $00, $08, $1c, $08, $10, $f0        ;; 03:5cca ????????
    db   $06, $08, $10, $f8, $0e, $08, $10, $00        ;; 03:5cd2 ????????
    db   $16, $08, $10, $08, $1e, $08, $10, $e0        ;; 03:5cda ????????
    db   $08, $00, $28, $e0, $00, $08, $28, $e0        ;; 03:5ce2 ????????
    db   $f8, $10, $28, $e0, $f0, $18, $28, $f0        ;; 03:5cea ????????
    db   $08, $02, $28, $f0, $00, $0a, $28, $f0        ;; 03:5cf2 ????????
    db   $f8, $12, $28, $f0, $f0, $1a, $28, $00        ;; 03:5cfa ????????
    db   $08, $04, $28, $00, $00, $0c, $28, $00        ;; 03:5d02 ????????
    db   $f8, $14, $28, $00, $f0, $1c, $28, $10        ;; 03:5d0a ????????
    db   $08, $06, $28, $10, $00, $0e, $28, $10        ;; 03:5d12 ????????
    db   $f8, $16, $28, $10, $f0, $1e, $28, $06        ;; 03:5d1a ????????
    db   $e8, $f8, $00, $00, $e8, $00, $06, $00        ;; 03:5d22 ????????
    db   $f8, $f8, $02, $00, $f8, $00, $08, $00        ;; 03:5d2a ????????
    db   $08, $f8, $04, $00, $08, $00, $0a, $00        ;; 03:5d32 ????????
    db   $06, $e8, $00, $00, $20, $e8, $f8, $06        ;; 03:5d3a ????????
    db   $20, $f8, $00, $02, $20, $f8, $f8, $08        ;; 03:5d42 ????????
    db   $20, $08, $00, $04, $20, $08, $f8, $0a        ;; 03:5d4a ????????
    db   $20, $10, $e0, $f0, $00, $00, $e0, $f8        ;; 03:5d52 ????????
    db   $08, $00, $e0, $00, $08, $20, $e0, $08        ;; 03:5d5a ????????
    db   $00, $20, $f0, $f0, $02, $00, $f0, $f8        ;; 03:5d62 ????????
    db   $0a, $00, $f0, $00, $0a, $20, $f0, $08        ;; 03:5d6a ????????
    db   $02, $20, $00, $f0, $04, $00, $00, $f8        ;; 03:5d72 ????????
    db   $0c, $00, $00, $00, $0c, $20, $00, $08        ;; 03:5d7a ????????
    db   $04, $20, $10, $f0, $06, $00, $10, $f8        ;; 03:5d82 ????????
    db   $0e, $00, $10, $00, $0e, $20, $10, $08        ;; 03:5d8a ????????
    db   $06, $20, $0c, $e8, $f0, $00, $08, $e8        ;; 03:5d92 ????????
    db   $f8, $06, $08, $e8, $00, $0c, $08, $e8        ;; 03:5d9a ????????
    db   $08, $12, $08, $f8, $f0, $02, $08, $f8        ;; 03:5da2 ????????
    db   $f8, $08, $08, $f8, $00, $0e, $08, $f8        ;; 03:5daa ????????
    db   $08, $14, $08, $08, $f0, $04, $08, $08        ;; 03:5db2 ????????
    db   $f8, $0a, $08, $08, $00, $10, $08, $08        ;; 03:5dba ????????
    db   $08, $16, $08, $0c, $e8, $08, $00, $28        ;; 03:5dc2 ????????
    db   $e8, $00, $06, $28, $e8, $f8, $0c, $28        ;; 03:5dca ????????
    db   $e8, $f0, $12, $28, $f8, $08, $02, $28        ;; 03:5dd2 ????????
    db   $f8, $00, $08, $28, $f8, $f8, $0e, $28        ;; 03:5dda ????????
    db   $f8, $f0, $14, $28, $08, $08, $04, $28        ;; 03:5de2 ????????
    db   $08, $00, $0a, $28, $08, $f8, $10, $28        ;; 03:5dea ????????
    db   $08, $f0, $16, $28, $12, $e8, $e8, $00        ;; 03:5df2 ????????
    db   $08, $e8, $f0, $06, $08, $e8, $f8, $0c        ;; 03:5dfa ????????
    db   $08, $e8, $00, $12, $08, $e8, $08, $18        ;; 03:5e02 ????????
    db   $08, $e8, $10, $1e, $08, $f8, $e8, $02        ;; 03:5e0a ????????
    db   $08, $f8, $f0, $08, $08, $f8, $f8, $0e        ;; 03:5e12 ????????
    db   $08, $f8, $00, $14, $08, $f8, $08, $1a        ;; 03:5e1a ????????
    db   $08, $f8, $10, $20, $08, $08, $e8, $04        ;; 03:5e22 ????????
    db   $08, $08, $f0, $0a, $08, $08, $f8, $10        ;; 03:5e2a ????????
    db   $08, $08, $00, $16, $08, $08, $08, $1c        ;; 03:5e32 ????????
    db   $08, $08, $10, $22, $08, $04, $f8, $f0        ;; 03:5e3a ????????
    db   $00, $08, $f8, $f8, $02, $08, $f8, $00        ;; 03:5e42 ????????
    db   $04, $08, $f8, $08, $06, $08, $1c, $e0        ;; 03:5e4a ????????
    db   $e4, $00, $08, $e0, $ec, $08, $08, $e0        ;; 03:5e52 ????????
    db   $f4, $10, $08, $e0, $fc, $18, $08, $e0        ;; 03:5e5a ????????
    db   $04, $20, $08, $e0, $0c, $28, $08, $e0        ;; 03:5e62 ????????
    db   $14, $30, $08, $f0, $e4, $02, $08, $f0        ;; 03:5e6a ????????
    db   $ec, $0a, $08, $f0, $f4, $12, $08, $f0        ;; 03:5e72 ????????
    db   $fc, $1a, $08, $f0, $04, $22, $08, $f0        ;; 03:5e7a ????????
    db   $0c, $2a, $08, $f0, $14, $32, $08, $00        ;; 03:5e82 ????????
    db   $e4, $04, $08, $00, $ec, $0c, $08, $00        ;; 03:5e8a ????????
    db   $f4, $14, $08, $00, $fc, $1c, $08, $00        ;; 03:5e92 ????????
    db   $04, $24, $08, $00, $0c, $2c, $08, $00        ;; 03:5e9a ????????
    db   $14, $34, $08, $10, $e4, $06, $08, $10        ;; 03:5ea2 ????????
    db   $ec, $0e, $08, $10, $f4, $16, $08, $10        ;; 03:5eaa ????????
    db   $fc, $1e, $08, $10, $04, $26, $08, $10        ;; 03:5eb2 ????????
    db   $0c, $2e, $08, $10, $14, $36, $08             ;; 03:5eba ???????
"""

line_pattern = re.compile(r'db\s+((?:\$[0-9a-fA-F]{2},?\s*)+)\s*;;\s*03:([0-9a-fA-F]{4})')
lines = []
for m in line_pattern.finditer(raw):
    addr = int(m.group(2), 16)
    bs = [int(x.strip().lstrip('$'), 16) for x in m.group(1).split(',') if x.strip()]
    lines.append((addr, bs))

mem = {}
for addr, bs in lines:
    for i, b in enumerate(bs):
        mem[addr + i] = b

PTR_START  = 0x59ea
PTR_END    = 0x5a78
DATA_START = 0x5a7a

ptr_table = []
addr = PTR_START
while addr <= PTR_END:
    lo = mem.get(addr, 0)
    hi = mem.get(addr+1, 0)
    ptr_table.append((hi << 8) | lo)
    addr += 2

destinations = sorted(set(w for w in ptr_table if w != 0))
label_map = {a: f".data_03_{a:04x}" for a in destinations}

# --- Flatten all data bytes into a single list (addr, byte) ---
flat = []
for (a, bs) in lines:
    if a >= DATA_START:
        for i, b in enumerate(bs):
            flat.append((a + i, b))

# Build label set (mutable)
label_addrs = set(destinations)

# --- Emit ---
out = []
out.append("data_03_59ea_SpriteData:")
for w in ptr_table:
    out.append(f"    dw   {label_map[w] if w else '$0000'}")
out.append("")

# Walk flat bytes; split db lines at label boundaries
# We'll collect a current run of bytes between labels
run_bytes = []
run_start = None

def flush_run(run_start, run_bytes, out):
    if not run_bytes:
        return
    # emit in rows of 8
    i = 0
    while i < len(run_bytes):
        chunk = run_bytes[i:i+8]
        hex_str = ", ".join(f"${b:02x}" for b in chunk)
        out.append(f"    db   {hex_str}")
        i += 8

for (a, b) in flat:
    if a in label_addrs:
        # flush current run
        flush_run(run_start, run_bytes, out)
        run_bytes = []
        run_start = a
        out.append(f"{label_map[a]}:")
        label_addrs.discard(a)
    if run_start is None:
        run_start = a
    run_bytes.append(b)

flush_run(run_start, run_bytes, out)

print("\n".join(out))
